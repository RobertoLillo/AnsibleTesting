---
- name: "Update repository index"
  apt:
    update_cache: yes
  tags:
    - common
    
- name: "Add the IP address of every hosts to all hosts"
  lineinfile:
    dest: /etc/hosts
    regexp: ".*{{ item }}$"
    line: "{{ hostvars[item].ansible_host }} {{ item }}"
    state: present
  when: hostvars[item].ansible_host is defined
  with_items: "{{ groups.all }}"
  tags:
    - common
    - host_update

- name: "Create installation directory"
  file:
    path: "{{ files_path }}"
    state: directory
  tags:
    - common