---
- name: "Copy Samba SSL certificate"
  shell:
    cmd: "openssl s_client -connect {{ samba_server_ip }}:636 </dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > /opt/sistema-centralizado/sambaCert.pem"

- name: "Add Samba SSL certificate to Java cacerts"
  shell:
    cmd: "docker exec -u 0 keycloak_app keytool -import -trustcacerts -file /opt/jboss/keycloak/sambaCert.pem -alias samba.diinf.lan -keystore /usr/lib/jvm/java-11-openjdk-11.0.11.0.9-2.el8_4.x86_64/lib/security/cacerts -storepass changeit -noprompt"
  ignore_errors: true